<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:image" content="fullpage.png">
  <title>Route Sense</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="shortcut icon" href="https://kavyaschool.edu.np/favicon.ico">
  <style>
    /* Individual brand colors for Kavya text */
    .kavya-text { font-weight: 900; display: inline-flex; }
    .k-orange { color: #f39200; }
    .a-red { color: #e30613; }
    .v-blue { color: #0071bc; }
    .y-green { color: #76c044; }
    .a-slate { color: #414042; }
    
    /* Smooth transition for search suggestions */
    #suggestions {
      scrollbar-width: thin;
      scrollbar-color: #76c044 #f1f5f9;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
<!-- HEADER -->
<header class="sticky top-0 backdrop-blur-sm z-50 border-b border-slate-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3 sm:gap-4">
        <a href="index.html" class="flex-shrink-0 transition-opacity hover:opacity-80">
          <img
            src="https://kavyaschool.edu.np/images/Kavya-Ing.svg"
            class="h-10 sm:h-12 md:h-14 w-auto object-contain"
            alt="Kavya Logo"
          />
        </a>
        <div class="hidden sm:block border-l border-slate-300 pl-3 sm:pl-4">
          <h1 class="text-lg sm:text-xl font-bold text-slate-900 leading-tight">Shuttle Finder</h1>
          <p class="text-xs sm:text-sm text-slate-600">Find your route</p>
        </div>
      </div>

      <a 
        href="admin.html"
        class="flex items-center gap-2 bg-slate-700 hover:from-slate-800 hover:to-black text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl font-semibold text-sm sm:text-base transition-all duration-200 shadow-lg hover:shadow-xl hover:-translate-y-0.5"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden sm:block">
          <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <span>Admin</span>
      </a>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 py-6 sm:py-10">
  <div class="  overflow-hidden border border-slate-100 mb-12">
    <div class="grid grid-cols-1 lg:grid-cols-2">
      
      <div class="p-8 sm:p-12 lg:p-16 flex flex-col justify-center">
        <div class="space-y-6">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-100 text-slate-600 text-xs font-bold uppercase tracking-widest">
            <i data-lucide="bus" class="w-3 h-3"></i> Student Shuttle Service
          </div>
          
          <h1 class="text-4xl sm:text-5xl xl:text-6xl font-black text-slate-900 leading-tight">
            Find the <br> <span class="text-[#76c044]">Best Shuttle</span><br>
            <span class="text-slate-700">from your stop</span>
          </h1>

          <p class="text-lg text-slate-600 leading-relaxed max-w-md">
            The official smart route finder for 
           Kavya School students.
          </p>

          <div class="space-y-4 pt-4">
            <div class="relative">
              <input id="searchInput" type="text" placeholder="Type your location (e.g. Gatthaghar)" 
                class="hidden w-full px-6 py-4 rounded-2xl border-2 border-slate-100 focus:border-[#76c044] focus:ring-4 focus:ring-[#76c044]/10 outline-none transition-all text-lg shadow-inner">
              <div id="suggestions" class="hidden absolute top-full left-0 right-0 mt-2 bg-white border border-slate-200 rounded-2xl shadow-2xl z-50 max-h-64 overflow-y-auto"></div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4">
              <button id="findBtn" class="flex-1 bg-[#76c044] hover:bg-[#68a93c] text-white px-8 py-4 rounded-2xl font-bold text-lg transition-all shadow-lg shadow-[#76c044]/30 flex items-center justify-center gap-2">
                <i data-lucide="search" class="w-5 h-5"></i> Find My Route
              </button>
              <button id="locationBtn" class="flex-1 bg-white border-[3px] border-slate-500 text-slate-600 hover:bg-slate-100 px-8 py-4 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-2 shadow-sm">
                <i data-lucide="map-pin" class="w-5 h-5"></i> Use GPS
              </button>
            </div>
            <p id="error" class="text-sm text-red-600 font-bold hidden bg-red-50 p-3 rounded-lg"></p>
          </div>
        </div>
      </div>

    <div class="bg-slate-50 flex items-center justify-center p-8">
        <img src="/shuttlenew.webp" class="w-full lg:max-w-[100%] drop-shadow-2xl object-contain rounded-xl" alt="Shuttle Illustration">
      </div>
    </div>
  </div>

  <section class="grid grid-cols-1 md:grid-cols-3 gap-8">
    <div class="bg-white p-8 rounded-[32px] border-b-8 border-blue-600 shadow-xl transition-all hover:-translate-y-2">
      <div class="w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center mb-6 text-blue-600">
        <i data-lucide="mouse-pointer-2" class="w-7 h-7"></i>
      </div>
      <h3 class="font-black text-xl text-slate-900 mb-3">Instant Search</h3>
      <p class="text-slate-600 leading-relaxed">
        Quickly find your stop within the 
        Kavya network across the valley.
      </p>
    </div>

    <div class="bg-white p-8 rounded-[32px] border-b-8 border-[#f39200] shadow-xl transition-all hover:-translate-y-2">
      <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center mb-6 text-[#f39200]">
        <i data-lucide="navigation" class="w-7 h-7"></i>
      </div>
      <h3 class="font-black text-xl text-slate-900 mb-3">GPS Ready</h3>
      <p class="text-slate-600 leading-relaxed">
        Let <span class="kavya-text text-[10px] uppercase">
         
        </span> Shuttle find the nearest pickup location based on your current coordinates.
      </p>
    </div>

    <div class="bg-white p-8 rounded-[32px] border-b-8 border-[#76c044] shadow-xl transition-all hover:-translate-y-2">
      <div class="w-14 h-14 bg-green-50 rounded-2xl flex items-center justify-center mb-6 text-[#76c044]">
        <i data-lucide="check-circle" class="w-7 h-7"></i>
      </div>
      <h3 class="font-black text-xl text-slate-900 mb-3">Verified Info</h3>
      <p class="text-slate-600 leading-relaxed">
        Access direct contact details for every authorized 
        Kavya shuttle driver.
      </p>
    </div>
  </section>
</main>

<footer class="py-12 text-center text-slate-400 font-medium">
  Developed by 
  <a href="https://github.com/itzbandhan" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">
    Bandhan
  </a>
  &
  <a href="https://github.com/pzdevv" class="text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">
    Swayam
  </a>
</footer>


<script>
let routesData = {};
const searchInput = document.getElementById("searchInput");
const suggestionsBox = document.getElementById("suggestions");
const errorBox = document.getElementById("error");
const findBtn = document.getElementById("findBtn");
const locationBtn = document.getElementById("locationBtn");

// Initialize Icons
lucide.createIcons();

// Load Data
fetch("index.json")
  .then(res => res.json())
  .then(data => { routesData = data; })
  .catch(() => { showError("Failed to load route data."); });

function getScore(query, text) {
  if (text === query) return 6;
  if (text.startsWith(query)) return 4;
  if (text.includes(query)) return 2;
  return 0;
}

searchInput.addEventListener("input", () => {
  const query = searchInput.value.trim().toLowerCase();
  suggestionsBox.innerHTML = "";
  errorBox.classList.add("hidden");

  if (!query) {
    suggestionsBox.classList.add("hidden");
    return;
  }

  let results = [];
  Object.entries(routesData).forEach(([routeId, route]) => {
    route.pickup_locations.forEach(loc => {
      const name = loc.name.toLowerCase();
      const score = getScore(query, name);
      if (score > 0) {
        results.push({
          routeId,
          routeName: route.route_name,
          location: loc.name,
          score: score + query.length / name.length
        });
      }
    });
  });

  if (!results.length) {
    suggestionsBox.classList.add("hidden");
    return;
  }

  results.sort((a, b) => b.score - a.score);
  const unique = [];
  const seen = new Set();

  for (let r of results) {
    if (!seen.has(r.routeId)) {
      unique.push(r);
      seen.add(r.routeId);
    }
    if (unique.length === 4) break;
  }

  unique.forEach(r => {
    const div = document.createElement("div");
    div.className = "px-6 py-4 cursor-pointer hover:bg-slate-50 transition-colors border-b last:border-b-0";
    div.innerHTML = `
      <div class="font-bold text-slate-900">${r.location}</div>
      <div class="text-sm text-slate-500">Route ${r.routeId} â€¢ ${r.routeName}</div>
    `;
    div.onclick = () => { window.location.href = `route.html?id=${r.routeId}`; };
    suggestionsBox.appendChild(div);
  });
  suggestionsBox.classList.remove("hidden");
});

findBtn.onclick = () => {
  if (searchInput.classList.contains("hidden")) {
    searchInput.classList.remove("hidden");
    searchInput.focus();
  } else {
    const query = searchInput.value.trim().toLowerCase();
    if (!query) { showError("Please type your nearest location."); return; }
    
    let bestMatch = null, bestScore = 0;
    Object.entries(routesData).forEach(([routeId, route]) => {
      route.pickup_locations.forEach(loc => {
        const score = getScore(query, loc.name.toLowerCase());
        if (score > bestScore) { bestScore = score; bestMatch = routeId; }
      });
    });

    if (!bestMatch) { showError("No matching route found."); return; }
    window.location.href = `route.html?id=${bestMatch}`;
  }
};

locationBtn.onclick = () => {
  errorBox.classList.add("hidden");
  if (!navigator.geolocation) { showError("Geolocation not supported."); return; }
  
  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude } = pos.coords;
    let closest = { dist: Infinity, routeId: null };
    Object.entries(routesData).forEach(([routeId, route]) => {
      route.pickup_locations.forEach(loc => {
        const d = haversine(latitude, longitude, parseFloat(loc.latitude), parseFloat(loc.longitude));
        if (d < closest.dist) closest = { dist: d, routeId };
      });
    });
    if (closest.dist > 5 || !closest.routeId) {
      showError("No route found nearby. Please search manually.");
      return;
    }
    window.location.href = `route.html?id=${closest.routeId}`;
  });
};

function showError(msg) {
  errorBox.innerText = msg;
  errorBox.classList.remove("hidden");
}

function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}
</script>
</body>
</html>